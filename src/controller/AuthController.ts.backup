import { UserService } from "../service/userService.js"
import type {Request, Response} from "express"
import bcrypt from "bcrypt"
import { generateAccessToken } from "../utils/jsonwebtoken.js";
const service = new UserService()
export class AuthController {

   static async login(req:Request, res:Response){
    const { email,password } = req.body;
    if(!email){
        res.json({message: "l'email est requit"})
    }
    try{
        const user = await service.findByEmail(email)
        const passwordValide = await bcrypt.compare(password, user!.password)
        if(!passwordValide){
            res.status(403).json({message: "le password est innvalide"})
        }
        const token = generateAccessToken(user!.id)
        res.status(200).json({success:true,message: "connexion reussie", token})

    }catch(error){
        res.status(500).json({message: "erreur serveur"})
    }

   }
}